<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Saurabh Mehta – PubMed Bibliography</title>
<style>
  body {font-family: Arial, sans-serif; margin: 2rem;}
  .paper {margin-bottom: 1.2rem; line-height: 1.4;}
  .title {font-weight: bold;}
  .authors {color: #555;}
  .journal {font-style: italic;}
</style>
</head>
<body>

<h1>Saurabh Mehta – PubMed Bibliography</h1>
<div id="bibliography">Loading…</div>

<script>
// ==== CONFIGURATION ==================================================
const COLLECTION_UID = '66626032';               // <-- your collection ID
const MAX_PMIDS      = 200;                      // NCBI allows up to 200 per request
// =====================================================================

// Helper: fetch JSON and handle errors
async function fetchJSON(url) {
  const resp = await fetch(url);
  if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
  return resp.json();
}

// Step A – get PMIDs from the collection
async function getPmids() {
  const linkUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/elink.fcgi?dbfrom=pubmed&linkname=pubmed_mycollections&db=pubmed&id=${COLLECTION_UID}&retmode=json`;
  const data = await fetchJSON(linkUrl);
  const linkSet = data?.linksets?.[0]?.linksetdbs?.[0]?.links ?? [];
  return linkSet.slice(0, MAX_PMIDS); // safety slice
}

// Step B – get summary info for those PMIDs
async function getSummaries(pmids) {
  const ids = pmids.join(',');
  const sumUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=pubmed&id=${ids}&retmode=json`;
  const data = await fetchJSON(sumUrl);
  return data.result;
}

// Step C – render
function renderBibliography(summaries, pmids) {
  const container = document.getElementById('bibliography');
  container.innerHTML = ''; // clear “Loading…”

  pmids.forEach(pmid => {
    const rec = summaries[pmids];
    if (!rec) return;

    const title   = rec.title || '';
    const authors = (rec.authors || []).map(a => a.name).join(', ');
    const journal = rec.fulljournalname || '';
    const year    = rec.pubdate?.split(' ')[0] || '';
    const doi     = rec.elocationid?.startsWith('doi:') ? rec.elocationid.replace('doi:', '') : '';

    const div = document.createElement('div');
    div.className = 'paper';
    div.innerHTML = `
      <div class="title"><a href="https://pubmed.ncbi.nlm.nih.gov/${pmid}/" target="_blank">${title}</a></div>
      <div class="authors">${authors}</div>
      <div class="journal">${journal} (${year})${doi ? ` – <a href="https://doi.org/${doi}" target="_blank">doi:${doi}</a>` : ''}</div>
    `;
    container.appendChild(div);
  });
}

// Orchestrate everything
(async () => {
  try {
    const pmids = await getPmids();
    if (pmids.length === 0) {
      document.getElementById('bibliography').textContent = 'No items found in the collection.';
      return;
    }
    const summaries = await getSummaries(pmids);
    renderBibliography(summaries, pmids);
  } catch (e) {
    console.error(e);
    document.getElementById('bibliography').textContent = 'Error loading bibliography.';
  }
})();
</script>

</body>
</html>

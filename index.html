<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Saurabh Mehta – PubMed Bibliography</title>
<style>
  /* --------------------------------------------------------------
     Simple, clean styling – feel free to replace with your own UI kit
     -------------------------------------------------------------- */
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                 Roboto, Helvetica, Arial, sans-serif;
    margin: 2rem;
    line-height: 1.5;
    color: #222;
    background: #fafafa;
  }
  h1 {
    margin-bottom: 1rem;
    font-size: 1.8rem;
  }
  .paper {
    margin-bottom: 1.4rem;
    padding-bottom: .6rem;
    border-bottom: 1px solid #e0e0e0;
  }
  .title a {
    text-decoration: none;
    color: #0066cc;
    font-weight: 600;
  }
  .title a:hover {
    text-decoration: underline;
  }
  .authors, .journal {
    font-size: .95rem;
    color: #555;
  }
  .journal a {
    color: #0066cc;
  }
</style>
</head>
<body>

<h1>Saurabh Mehta – PubMed Bibliography</h1>
<div id="bibliography">Loading…</div>

<script>
/* --------------------------------------------------------------
   Configuration – only the collection UID needs to match yours
   -------------------------------------------------------------- */
const COLLECTION_UID = '66626032';   // <-- your public My NCBI collection ID
const MAX_PMIDS      = 200;         // NCBI caps at 200 IDs per request

/* --------------------------------------------------------------
   Small helper to fetch JSON and surface HTTP errors
   -------------------------------------------------------------- */
async function fetchJSON(url) {
  const resp = await fetch(url);
  if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
  return resp.json();
}

/* --------------------------------------------------------------
   Step A – retrieve the list of PMIDs belonging to the collection
   -------------------------------------------------------------- */
async function getPmids() {
  const linkUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/elink.fcgi?` +
                  `dbfrom=pubmed&linkname=pubmed_mycollections&db=pubmed` +
                  `&id=${COLLECTION_UID}&retmode=json`;
  const data = await fetchJSON(linkUrl);
  const links = data?.linksets?.[0]?.linksetdbs?.[0]?.links ?? [];
  return links.slice(0, MAX_PMIDS);           // safety slice
}

/* --------------------------------------------------------------
   Step B – pull the citation summary for those PMIDs
   -------------------------------------------------------------- */
async function getSummaries(pmids) {
  const ids = pmids.join(',');
  const sumUrl = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?` +
                 `db=pubmed&id=${ids}&retmode=json`;
  const data = await fetchJSON(sumUrl);
  return data.result;                         // keyed by PMID
}

/* --------------------------------------------------------------
   Step C – render the bibliography into the page
   -------------------------------------------------------------- */
function renderBibliography(summaries, pmids) {
  const container = document.getElementById('bibliography');
  container.textContent = '';                 // clear “Loading…”
  
  pmids.forEach(pmid => {
    const rec = summaries[pmid];
    if (!rec) return;                         // skip missing entries
    
    const title   = rec.title ?? '';
    const authors = (rec.authors ?? [])
                      .map(a => a.name)
                      .join(', ');
    const journal = rec.fulljournalname ?? '';
    const year    = (rec.pubdate ?? '').split(' ')[0] ?? '';
    const doiRaw  = rec.elocationid?.startsWith('doi:')
                    ? rec.elocationid.replace('doi:', '')
                    : '';
    const doiLink = doiRaw
                    ? `<a href="https://doi.org/${doiRaw}" target="_blank" rel="noopener noreferrer">doi:${doiRaw}</a>`
                    : '';
    
    const paperDiv = document.createElement('div');
    paperDiv.className = 'paper';
    paperDiv.innerHTML = `
      <div class="title"><a href="https://pubmed.ncbi.nlm.nih.gov/${pmid}/" target="_blank" rel="noopener noreferrer">${title}</a></div>
      <div class="authors">${authors}</div>
      <div class="journal">${journal} (${year})${doiLink ? ' – ' + doiLink : ''}</div>
    `;
    container.appendChild(paperDiv);
  });
}

/* --------------------------------------------------------------
   Orchestrator – run the three steps, handling errors gracefully
   -------------------------------------------------------------- */
(async () => {
  try {
    const pmids = await getPmids();
    if (pmids.length === 0) {
      document.getElementById('bibliography').textContent =
        'No items found in the collection.';
      return;
    }
    const summaries = await getSummaries(pmids);
    renderBibliography(summaries, pmids);
  } catch (err) {
    console.error(err);
    document.getElementById('bibliography').textContent =
      'Error loading bibliography – please check the console for details.';
  }
})();
</script>

</body>
</html>
